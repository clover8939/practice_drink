<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­”é¡Œçµæœ</title>
    <style>
        body { 
            font-family: 'Arial', sans-serif; 
            background-color: #f8f9fa; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0;
            padding: 20px;
        }
        .container { 
            max-width: 700px; 
            margin: auto; 
            background: white; 
            padding: 40px; 
            border-radius: 12px; 
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        /* æ¨™é¡Œ */
        h1 { 
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }
        h1.all-correct { 
            color: #28a745; 
        }
        h1.some-wrong { 
            color: #ffc100;
        }
        h1.all-wrong { 
            color: #dc3545; 
        }
        
        /* çµ±è¨ˆè³‡è¨Š */
        .score-summary {
            text-align: center;
            padding: 20px;
            background-color: #f0f0f0;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .score-text {
            font-size: 1.3em;
            color: #495057;
            margin: 10px 0;
        }
        
        /* ç­”æ¡ˆè©³æƒ… */
        .answer-detail {
            background-color: #f8f9fa;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border-left: 4px solid #ccc;
        }
        .answer-detail.correct {
            border-left-color: #28a745;
            background-color: #f0fdf4;
        }
        .answer-detail.wrong {
            border-left-color: #dc3545;
            background-color: #fef2f2;
        }
        
        .answer-label {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1em;
        }
        .answer-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            margin-left: 10px;
        }
        .answer-status.correct {
            background-color: #28a745;
            color: white;
        }
        .answer-status.wrong {
            background-color: #dc3545;
            color: white;
        }
        
        .answer-values {
            margin-top: 10px;
            font-size: 0.95em;
            color: #495057;
        }
        .user-choice {
            margin: 5px 0;
        }
        .user-choice.wrong {
            color: #dc3545;
        }
        .correct-answer {
            margin: 5px 0;
            color: #28a745;
            font-weight: bold;
        }
        
        /* æŒ‰éˆ• */
        .action-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .action-btn {
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            text-decoration: none;
            cursor: pointer;
            border: none;
            transition: opacity 0.3s;
        }
        .next-btn { 
            background-color: #007bff; 
            color: white; 
        }
        .next-btn:hover { 
            background-color: #0056b3; 
        }
        .home-btn { 
            background-color: #6c757d; 
            color: white; 
        }
        .home-btn:hover { 
            background-color: #5a6268; 
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¨™é¡Œ -->
        {% if all_correct %}
            <h1 class="all-correct">ğŸ‰ å¤ªæ£’äº†ï¼å…¨éƒ¨ç­”å°ï¼</h1>
        {% elif results and results|length > 0 and results|selectattr('correct', 'equalto', True)|list|length > 0 %}
            <h1 class="some-wrong">âš ï¸ éƒ¨åˆ†ç­”é¡Œæœ‰èª¤</h1>
        {% else %}
            <h1 class="all-wrong">âŒ å†åŠ æ²¹ï¼</h1>
        {% endif %}
        
        <!-- çµ±è¨ˆ -->
        {% if results and results|length > 0 %}
        <div class="score-summary">
            {% set correct_count = results|selectattr('correct', 'equalto', True)|list|length %}
            <div class="score-text">
                æ­£ç¢º: <strong style="color: #28a745;">{{ correct_count }}/{{ results|length }}</strong>
            </div>
            {% if results|length > 1 %}
            <div style="font-size: 0.9em; color: #6c757d;">
                {% set percentage = (correct_count / results|length * 100)|int %}
                å¾—åˆ†: {{ percentage }}%
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- è©³ç´°ç­”æ¡ˆ -->
        {% for result in results %}
        <div class="answer-detail {% if result.correct %}correct{% else %}wrong{% endif %}">
            <div class="answer-label">
                {% if result.correct %}âœ“{% else %}âœ—{% endif %} 
                {% if result.drink_name %}
                    <strong>{{ result.drink_name }}</strong> - {{ result.attribute_name if result.attribute_name else 'é…æ–™ ' ~ loop.index }}
                {% elif result.attribute_name %}
                    {{ result.attribute_name }}
                {% else %}
                    é…æ–™ {{ loop.index }}
                {% endif %}
                <span class="answer-status {% if result.correct %}correct{% else %}wrong{% endif %}">
                    {% if result.correct %}æ­£ç¢º{% else %}éŒ¯èª¤{% endif %}
                </span>
            </div>

            {% if result.question_text %}
                <div style="margin-top: 6px; color:#495057;">
                    <span style="color:#6c757d;">é¡Œç›®ï¼š</span>{{ result.question_text }}
                    {% if result.unit %}<span style="color:#dc3545; font-weight:bold;">{{ result.unit }}</span>{% endif %}
                </div>
            {% endif %}
            
            <div class="answer-values">
                {% if not result.correct %}
                <div class="user-choice wrong">
                    ä½ çš„ç­”æ¡ˆ: <strong style="color: #dc3545;">{{ result.user_choice }}</strong> âŒ
                </div>
                {% else %}
                <div class="user-choice">
                    ä½ çš„ç­”æ¡ˆ: <strong style="color: #28a745;">{{ result.user_choice }}</strong> âœ“
                </div>
                {% endif %}
                <div class="correct-answer">
                    æ­£ç¢ºç­”æ¡ˆ: <strong style="color: #28a745;">{{ result.correct_answer }}</strong> âœ“
                </div>
            </div>
        </div>
        {% endfor %}
        
        <!-- æŒ‰éˆ• -->
        <div class="action-group">
            <form action="{{ url_for('quiz') }}" method="POST" style="display: inline;">
                <input type="hidden" name="category_filter" value="{{ request_form.get('category_filter') }}">
                <input type="hidden" name="drink_filter" value="{{ request_form.get('drink_filter') }}">
                <input type="hidden" name="quiz_mode" value="{{ request_form.get('quiz_mode', 'all') }}">
                <button type="submit" class="action-btn next-btn">å†ä¾†ä¸€ä»½é£²æ–™</button>
            </form>

            <a href="{{ url_for('index') }}" class="action-btn home-btn">å›é¦–é </a>
        </div>
    </div>
</body>
</html>
